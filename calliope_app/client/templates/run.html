{% extends 'configure.html' %}

{% load static %}
{% load i18n %}

{% block head %}
<title>Engage | {{ model.name }} | Runs</title>
<script type="text/javascript" src="{% static 'js/run.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jeditable.js/2.0.13/jquery.jeditable.min.js"></script>
<style media="screen">
	#updates_paused {
		display: none;
	}
    html, body {
      height: 100%;
      overflow-y: hidden;
    }
</style>
{% endblock %}

{% block config_runs %}<h5><i class="fas fa-play"></i>&nbsp;&nbsp;<b>{% trans "Runs" %}</b></h5>{% endblock %}
{% block config_5_sync %}<i class="fas fa-sync"></i>{% endblock %}
{% block config_5_tab %}tab-active{% endblock %}

{% block content %}
<div id="subheader2" class="row content_navigation">
	{% include "scenario_selector.html" %}
</div>
<div class="row" style="overflow-y: scroll; height:460px; border:solid; position: relative; min-height: 10 px; max-height: 100% - 10 px;">
	<span id="build-error" style="color:red"></span>
    <div id="viz_outputs_container" style="width: 100%;"></div>
    <div id="viz_logs_container" class="rounded col-12" style="display: none; background-color: black; color: white;"></div>
	<div class="viz-spinner centered">
		<div class="spinner-grow" style="width: 10rem; height: 10rem;" role="status">
		  <span class="sr-only">Loading...</span>
		</div>
		<div style="color: #a2a2a2;font-weight: bold;">Loading...</div>
	</div>
</div>


<div id = "splitter" style = "height:15px; width:100%; cursor:row-resize; background-color:black" >
	<button onclick = "toggleSize(document.getElementById('run_dashboard'))" type="button" style = "position: absolute; right: 20px; height: 15px; line-height: 5px; border : none; border-radius : 2px; background-color: #ffd53d;" id= 'minimize'>- 
	</button> 
</div> 


<div id="updates_paused" class="row">
	<div class="col-12 alert alert-warning">
		<button class="btn btn-sm btn-warning" onClick="window.location.reload();">{% trans "Refresh" %}</button> {% trans "Dashboard updates have been paused for" %} <span id="pause_time" class="font-weight-bold">0 {% trans "seconds" %}</span>.
	</div>
</div>
<div class="row" style="white-space: nowrap; overflow-y: scroll; height: calc(100% - 595px);" id="run_dashboard"></div>


<script>
	function resize(element){
		var md;
		const viz = document.getElementsByClassName('row')[5];
		const dashboard = document.getElementById('run_dashboard');
		element.onmousedown = onMouseDown;
		function onMouseDown(e){
			//console.log('mouse down')
			md = {e,
				  vizHeight : viz.offsetHeight,
				  dashboardHeight : dashboard.offsetHeight,
				};
			console.log(md.vizHeight)
			document.onmousemove = onMouseMove;
			document.onmouseup = () => {
				//console.log('mouse up');
				document.onmousemove = document.onmouseup = null;
			}
		}

		function onMouseMove(e){
	
			var delta = {x: e.clientX - md.e.clientX,
						 y: e.clientY - md.e.clientY};
			delta.y = Math.min(Math.max(delta.y, -md.vizHeight),
								md.dashboardHeight);
			
			
			viz.style.height = (md.vizHeight + delta.y) + "px";
			dashboard.style.height = (md.dashboardHeight - delta.y) + "px"
			console.log(parseInt(viz.style.height))
			if (parseInt(dashboard.style.height) > 0){
				document.getElementById('minimize').textContent = '-'
			}
			if ((parseInt(viz.style.height) > (md.vizHeight + 10)) && parseInt(viz.style.height) > ((parseInt(md.vizHeight) + parseInt(md.dashboardHeight))* .7)){
				toggleSize(dashboard)
			}
		}

	}

	function toggleSize(element){
		const viz = document.getElementsByClassName('row')[5];
		if (element.style.height > 10 + "px"){
			//minimize the run dashboard
			viz.style.height = 'calc(100% - 160px)'
			element.style.height = '0px'
			document.getElementById('minimize').textContent = '+'
			
		}
		else{
			viz.style.height = 460 + "px"
			element.style.height = 'calc(100% - 600px)'
			document.getElementById('minimize').textContent = '-'
			//console.log(element.style.height)
		}
	}



resize(document.getElementById('splitter'))
</script>
{% endblock %}